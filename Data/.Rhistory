Geography$GeographyRegion[Geography$GeographyDescription=='US General']<-'USA Domestic'
Geography$GeographyIntDom[Geography$GeographyDescription=='US General']<-'USA Domestic'
Geography$GeographyRegion[Geography$GeographyDescription=='International General']<-'International General'
Geography$GeographyRegion[Geography$GeographyDescription=='Australia & Pacific']<-'Australia & Pacific'
Geography$GeographyRegion[Geography$GeographyDescription=='Somaliland']<-'Africa'
Geography$GeographyCategory<-"Other"
Geography$GeographyCategory[Geography$GeographyRegion=='USA Domestic']<-'USA Domestic'
Geography$GeographyCategory[Geography$GeographyIntDom=='USA Domestic']<-'USA Domestic'
Geography$GeographyCategory[Geography$GeographyDescription=='SoCal']<-'USA Domestic'
Geography$GeographyCategory[Geography$GeographyRegion=='Africa']<-'Africa'
Geography$GeographyCategory[Geography$GeographyDescription=='Africa']<-'Africa'
Geography$GeographyRegion[Geography$GeographyDescription=='Africa']<-'Africa'
Geography$GeographyCategory[Geography$GeographyRegion=='Latin America']<-'Latin America'
Geography$GeographyCategory[Geography$GeographyDescription=='Latin America']<-'Latin America'
Geography$GeographyRegion[Geography$GeographyDescription=='Latin America']<-'Latin America'
Geography$GeographyCategory[Geography$GeographyRegion=='International General']<-'International General'
Geography$GeographyRegion[is.na(Geography$GeographyRegion)]<-Geography$GeographyDescription[is.na(Geography$GeographyRegion)]
Geography<-Geography%>%
mutate(GeographyCountry=ifelse(GeographyCategory=="USA Domestic","United States",GeographyDescription))
##ProgramArea
##These filters to AttribTypeIds could be done directly in SQL queries
ProgramArea_Raw<-filter(HasAttribs, AttribTypeId==71)
unique(ProgramArea_Raw$Description[is.na(ProgramArea_Raw$ParentPath)])
ProgramAreas<-ProgramArea_Raw%>%
separate(ParentPath, c("Program", "Theme","Objective"), sep='\\|')%>%
mutate(Outcome=ifelse(!is.na(Objective),Description,NA),
Objective=ifelse(is.na(Objective)&!is.na(Theme),Description,Objective),
Theme=ifelse(is.na(Theme)&!is.na(Program),Description,Theme),
Program=ifelse(is.na(Program),Description,Program),
Program=ifelse(is.na(Theme)&!is.na(ShortName),ShortName,Program))%>%
dplyr::select(6,8,9,15,20,21,22,23)%>%
mutate(AllocationPercentage=AllocationPercentage/100)%>%
mutate(Program=ifelse(Program=="Cross Program Giving","Cross",Program),
Program=ifelse(Program=="Member-Initiated Grants","MIG",Program),
Program=ifelse(Program=="Second Generation Giving","2G",Program),
Program=ifelse(Program=="RR","WR",Program),
Program=ifelse(Program=="President's Fund","Pres",Program),
Program=ifelse(Program=="Perspective Fund","PF",Program))%>%
mutate(Priority=ifelse(is.na(Priority),1,Priority))
ProgramAreasPayments<-ProgramAreas%>%
filter(!is.na(PaymentId))%>%
dplyr::select(-1)
ProgramAreasRequests<-ProgramAreas%>%
filter(!is.na(RequestId))
colnames(ProgramAreasRequests) <- paste("Request", colnames(ProgramAreasRequests), sep = "")
##Statuses
Statuses<-Statuses_Raw%>%
mutate(Status=ifelse(is.na(ParentPath),Name,ParentPath),
DetailedStatus=Name)%>%
dplyr::select(1,23,24)
#Special Circumstances
Special_Circumstances_Raw<-filter(HasAttribs, AttribTypeId==63)
#Support Type
SupportType_Raw<-filter(HasAttribs, AttribTypeId==18 & Priority==1) ##Note primary support type
SupportType<-SupportType_Raw[,c(6,18)]
colnames(SupportType) <- paste("SupportType", colnames(SupportType), sep = "")
library(tidycensus)
library(sf)
library(tidyverse)
library(jsonlite)
library(geojsonio)
library(hrbrthemes)
library(formattable)
library(scales)
library(ggrepel)
library(ggthemes)
##Change to your wd where repo is cloned to pull in any auxiliary data that may be useful
setwd("C:/Users/rcarder/Documents/dev/DurhamUpzoning/data/")
Sys.getenv("census_api_key")
##To explore fields available in the ACS
census_variables<-load_variables(2020, "pl")
acs_variables<-load_variables(2020, "acs5")
##Geographic Level (county, state, tract, zcta (ZIP), block group, congressional district, public use microdata area)
geoLevel='block group'  ##Zip Codes with approximate tabulation areas (ZIP codes are not actual polygons)
state="North Carolina"
county="Durham"
sumfile = 'acs5'
acs_race_variables<-c(sapply(seq(2,7,1), function(v) return(paste("B02001_",str_pad(v,3,pad ="0"),sep=""))),"B03002_001","B03002_002","B03002_003", "B03002_012")
acs_income_poverty_variables<-c("B19083_001",'B19301_001', 'B17021_001', 'B17021_002')
acs_language_variables<-c('B16001_001', 'B16001_002', 'B16001_003', 'B16001_004', 'B16001_005')
acs_rent_cost_variables<-c(sapply(seq(1,27,1), function(v) return(paste("B25063_",str_pad(v,3,pad ="0"),sep=""))))
acs_rent_percent_income_variables<-c(sapply(seq(1,11,1), function(v) return(paste("B25070_",str_pad(v,3,pad ="0"),sep=""))))
acs_income_to_poverty_variables<-c(sapply(seq(1,13,1), function(v) return(paste("B17026_",str_pad(v,3,pad ="0"),sep=""))))
acs_housing_costs_variables<-c(sapply(seq(1,17,1), function(v) return(paste("B25104_",str_pad(v,3,pad ="0"),sep=""))))
all_variables<-as.data.frame(c(acs_race_variables,acs_income_poverty_variables,acs_language_variables,acs_rent_cost_variables,acs_rent_percent_income_variables,acs_income_to_poverty_variables,acs_housing_costs_variables))%>%
dplyr::rename("name"=1)%>%
left_join(acs_variables)
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,5))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,word),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)
acs_call_table <- get_acs(geography = geoLevel,
variables = c(acs_race_variables,
acs_income_poverty_variables,
#acs_housing_costs_variables,
acs_rent_cost_variables,
acs_rent_percent_income_variables),
year = 2020,
sumfile = sumfile,
state = state,
county=county,
geometry = FALSE) %>%
dplyr::select(-moe) %>%
pivot_wider(names_from = variable, values_from = estimate)%>%
dplyr::rename("White Alone"=3,
"Black Alone"=4,
"American Indian Alone"=5,
"Asian Alone"=6,
"Pacific Islander/Hawaiian Alone"=7,
"Other Alone"=8,
"Total Pop Hispanic Tables"=9,
"Total Non-Hispanic"=10,
"Non-Hispanic White"=11,
"Total Hispanic"=12)
View(acs_call_table)
View(acs_variables)
acs_pop<-"B01001_001"
acs_call_table <- get_acs(geography = geoLevel,
variables = c(acs_race_variables,
acs_pop,
acs_income_poverty_variables,
#acs_housing_costs_variables,
acs_rent_cost_variables,
acs_rent_percent_income_variables),
year = 2020,
sumfile = sumfile,
state = state,
county=county,
geometry = FALSE) %>%
dplyr::select(-moe) %>%
pivot_wider(names_from = variable, values_from = estimate)%>%
dplyr::rename("White Alone"=3,
"Black Alone"=4,
"American Indian Alone"=5,
"Asian Alone"=6,
"Pacific Islander/Hawaiian Alone"=7,
"Other Alone"=8,
"Total Pop Hispanic Tables"=9,
"Total Non-Hispanic"=10,
"Non-Hispanic White"=11,
"Total Hispanic"=12)
View(acs_call_table)
acs_call_table <- get_acs(geography = geoLevel,
variables = c(acs_race_variables,
acs_pop,
acs_income_poverty_variables,
#acs_housing_costs_variables,
acs_rent_cost_variables,
acs_rent_percent_income_variables),
year = 2020,
sumfile = sumfile,
state = state,
county=county,
geometry = FALSE) %>%
dplyr::select(-moe) %>%
pivot_wider(names_from = variable, values_from = estimate)
View(variables_join)
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,5))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,word),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,5))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,word),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)%>%
pivot_wider(names_from = label)
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,5))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,word),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)%>%
mutate(value-"x")%>%
pivot_wider(names_from = label, values_from = value)
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,5))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,word),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)%>%
mutate(value="x")%>%
pivot_wider(names_from = label, values_from = value)
all_variables<-as.data.frame(c(acs_pop,acs_race_variables,acs_income_poverty_variables,acs_language_variables,acs_rent_cost_variables,acs_rent_percent_income_variables,acs_income_to_poverty_variables,acs_housing_costs_variables))%>%
dplyr::rename("name"=1)%>%
left_join(acs_variables)
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,5))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,word),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)%>%
mutate(value="x")%>%
pivot_wider(names_from = label, values_from = value)
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,5))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,word),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)#%>%
acs_call_table <- get_acs(geography = geoLevel,
variables = c(acs_race_variables,
acs_pop,
acs_income_poverty_variables,
#acs_housing_costs_variables,
acs_rent_cost_variables,
acs_rent_percent_income_variables),
year = 2020,
sumfile = sumfile,
state = state,
county=county,
geometry = FALSE) %>%
dplyr::select(-moe)
acs_call_table <- get_acs(geography = geoLevel,
variables = c(acs_race_variables,
acs_pop,
acs_income_poverty_variables,
#acs_housing_costs_variables,
acs_rent_cost_variables,
acs_rent_percent_income_variables),
year = 2020,
sumfile = sumfile,
state = state,
county=county,
geometry = FALSE) %>%
dplyr::select(-moe) %>%
left_join(variables_join,by=variable)
acs_call_table <- get_acs(geography = geoLevel,
variables = c(acs_race_variables,
acs_pop,
acs_income_poverty_variables,
#acs_housing_costs_variables,
acs_rent_cost_variables,
acs_rent_percent_income_variables),
year = 2020,
sumfile = sumfile,
state = state,
county=county,
geometry = FALSE) %>%
dplyr::select(-moe) %>%
left_join(variables_join,by="variable")
acs_call_table <- get_acs(geography = geoLevel,
variables = c(acs_race_variables,
acs_pop,
acs_income_poverty_variables,
#acs_housing_costs_variables,
acs_rent_cost_variables,
acs_rent_percent_income_variables),
year = 2020,
sumfile = sumfile,
state = state,
county=county,
geometry = FALSE) %>%
dplyr::select(-moe) %>%
left_join(variables_join,by="variable")%>%
pivot_wider(names_from = label,values_from = estimate)
acs_call_table <- get_acs(geography = geoLevel,
variables = c(acs_race_variables,
acs_pop,
acs_income_poverty_variables,
#acs_housing_costs_variables,
acs_rent_cost_variables,
acs_rent_percent_income_variables),
year = 2020,
sumfile = sumfile,
state = state,
county=county,
geometry = FALSE) %>%
dplyr::select(-moe) %>%
left_join(variables_join,by="variable")
acs_call_table <- get_acs(geography = geoLevel,
variables = c(acs_race_variables,
acs_pop,
acs_income_poverty_variables,
#acs_housing_costs_variables,
acs_rent_cost_variables,
acs_rent_percent_income_variables),
year = 2020,
sumfile = sumfile,
state = state,
county=county,
geometry = FALSE) %>%
dplyr::select(-moe) %>%
left_join(variables_join,by="variable")%>%
dplyr::select(-3)%>%
pivot_wider(names_from = label,values_from = estimate)
acs_rent_cost_variables<-c(sapply(seq(1,27,1), function(v) return(paste("B25063_",str_pad(v,3,pad ="0"),sep=""))))
acs_race_variables<-c(sapply(seq(2,7,1), function(v) return(paste("B02001_",str_pad(v,3,pad ="0"),sep=""))),"B03002_001","B03002_002","B03002_003", "B03002_012")
acs_race_variables<-c(sapply(seq(1,7,1), function(v) return(paste("B02001_",str_pad(v,3,pad ="0"),sep=""))),"B03002_001","B03002_002","B03002_003", "B03002_012")
acs_race_variables<-c(sapply(seq(1,7,1), function(v) return(paste("B02001_",str_pad(v,3,pad ="0"),sep=""))),"B03002_001","B03002_002","B03002_003", "B03002_012")
acs_income_poverty_variables<-c("B19083_001",'B19301_001', 'B17021_001', 'B17021_002')
acs_language_variables<-c('B16001_001', 'B16001_002', 'B16001_003', 'B16001_004', 'B16001_005')
acs_rent_cost_variables<-c(sapply(seq(1,27,1), function(v) return(paste("B25063_",str_pad(v,3,pad ="0"),sep=""))))
acs_rent_percent_income_variables<-c(sapply(seq(1,11,1), function(v) return(paste("B25070_",str_pad(v,3,pad ="0"),sep=""))))
acs_income_to_poverty_variables<-c(sapply(seq(1,13,1), function(v) return(paste("B17026_",str_pad(v,3,pad ="0"),sep=""))))
acs_housing_costs_variables<-c(sapply(seq(1,17,1), function(v) return(paste("B25104_",str_pad(v,3,pad ="0"),sep=""))))
all_variables<-as.data.frame(c(acs_pop,acs_race_variables,acs_income_poverty_variables,acs_language_variables,acs_rent_cost_variables,acs_rent_percent_income_variables,acs_income_to_poverty_variables,acs_housing_costs_variables))%>%
dplyr::rename("name"=1)%>%
left_join(acs_variables)
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,5))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,word),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)#%>%
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,5))
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,5))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,concept),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)#%>%
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,2))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,word),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)#%>%
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,1))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,word),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)#%>%
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,1))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,concept),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)#%>%
View(acs_call_table)
acs_call_table <- get_acs(geography = geoLevel,
variables = c(acs_race_variables,
acs_pop,
acs_income_poverty_variables,
#acs_housing_costs_variables,
acs_rent_cost_variables,
acs_rent_percent_income_variables),
year = 2020,
sumfile = sumfile,
state = state,
county=county,
geometry = FALSE) %>%
dplyr::select(-moe) %>%
left_join(variables_join,by="variable")%>%
dplyr::select(-3)%>%
pivot_wider(names_from = label,values_from = estimate)
acs_call_table <- get_acs(geography = geoLevel,
variables = c(acs_race_variables,
acs_income_poverty_variables,
#acs_housing_costs_variables,
acs_rent_cost_variables,
acs_rent_percent_income_variables),
year = 2020,
sumfile = sumfile,
state = state,
county=county,
geometry = FALSE) %>%
dplyr::select(-moe) %>%
left_join(variables_join,by="variable")%>%
dplyr::select(-3)%>%
pivot_wider(names_from = label,values_from = estimate)
Durham_Block_Group_Join_ACS_Pre<-get_acs(geography = geoLevel,
variables = c("B01001_001"),
year=2020,
county=county,
state=state,
geometry = TRUE)%>%
left_join(acs_call_table, by="GEOID")%>%
dplyr::select(-3,-6)%>%
dplyr::rename("NAME"=2,
"Total Population"=3)
View(Durham_Block_Group_Join_ACS_Pre)
acs_rent_own<-c('B25008_001', 'B25008_002', 'B25008_003')
all_variables<-as.data.frame(c(acs_pop,acs_race_variables,acs_rent_own,acs_income_poverty_variables,acs_language_variables,acs_rent_cost_variables,acs_rent_percent_income_variables,acs_income_to_poverty_variables,acs_housing_costs_variables))%>%
dplyr::rename("name"=1)%>%
left_join(acs_variables)
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,1))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,concept),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)#%>%
acs_home_values<-c('B25082_002', 'B25082_003')
all_variables<-as.data.frame(c(acs_pop,acs_race_variables,acs_rent_own,acs_income_poverty_variables,acs_language_variables,acs_home_values,acs_rent_cost_variables,acs_rent_percent_income_variables,acs_income_to_poverty_variables,acs_housing_costs_variables))%>%
dplyr::rename("name"=1)%>%
left_join(acs_variables)
acs_call_table <- get_acs(geography = geoLevel,
variables = c(acs_race_variables,
acs_income_poverty_variables,
#acs_housing_costs_variables,
acs_home_values,
acs_rent_own,
acs_rent_cost_variables,
acs_rent_percent_income_variables),
year = 2020,
sumfile = sumfile,
state = state,
county=county,
geometry = FALSE) %>%
dplyr::select(-moe) %>%
left_join(variables_join,by="variable")%>%
dplyr::select(-3)%>%
pivot_wider(names_from = label,values_from = estimate)
all_variables<-as.data.frame(c(acs_pop,acs_race_variables,acs_rent_own,acs_income_poverty_variables,acs_language_variables,acs_home_values,acs_rent_cost_variables,acs_rent_percent_income_variables,acs_income_to_poverty_variables,acs_housing_costs_variables))%>%
dplyr::rename("name"=1)%>%
left_join(acs_variables)
all_variables<-as.data.frame(c(acs_pop,acs_race_variables,acs_rent_own,acs_income_poverty_variables,acs_language_variables,acs_home_values,acs_rent_cost_variables,acs_rent_percent_income_variables,acs_income_to_poverty_variables,acs_housing_costs_variables))%>%
dplyr::rename("name"=1)%>%
left_join(acs_variables)
acs_home_values<-c('B25082_002', 'B25082_003')
all_variables<-as.data.frame(c(acs_pop,acs_race_variables,acs_rent_own,acs_income_poverty_variables,acs_language_variables,acs_home_values,acs_rent_cost_variables,acs_rent_percent_income_variables,acs_income_to_poverty_variables,acs_housing_costs_variables))%>%
dplyr::rename("name"=1)%>%
left_join(acs_variables)
acs_home_values
all_variables<-as.data.frame(c(acs_pop,acs_race_variables,acs_rent_own,acs_income_poverty_variables,acs_language_variables,acs_home_values,acs_rent_cost_variables,acs_rent_percent_income_variables,acs_income_to_poverty_variables,acs_housing_costs_variables))%>%
dplyr::rename("name"=1)%>%
left_join(acs_variables)
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,1))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,concept),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)#%>%
acs_call_table <- get_acs(geography = geoLevel,
variables = c(acs_race_variables,
acs_income_poverty_variables,
#acs_housing_costs_variables,
acs_home_values,
acs_rent_own,
acs_rent_cost_variables,
acs_rent_percent_income_variables),
year = 2020,
sumfile = sumfile,
state = state,
county=county,
geometry = FALSE) %>%
dplyr::select(-moe) %>%
left_join(variables_join,by="variable")%>%
dplyr::select(-3)%>%
pivot_wider(names_from = label,values_from = estimate)
acs_pop<-"B01001_001"
acs_race_variables<-c(sapply(seq(1,7,1), function(v) return(paste("B02001_",str_pad(v,3,pad ="0"),sep=""))),"B03002_001","B03002_002","B03002_003", "B03002_012")
acs_income_poverty_variables<-c("B19083_001",'B19301_001', 'B17021_001', 'B17021_002')
acs_language_variables<-c('B16001_001', 'B16001_002', 'B16001_003', 'B16001_004', 'B16001_005')
acs_rent_own<-c('B25008_001', 'B25008_002', 'B25008_003')
acs_rent_cost_variables<-c(sapply(seq(1,27,1), function(v) return(paste("B25063_",str_pad(v,3,pad ="0"),sep=""))))
acs_rent_percent_income_variables<-c(sapply(seq(1,11,1), function(v) return(paste("B25070_",str_pad(v,3,pad ="0"),sep=""))))
acs_income_to_poverty_variables<-c(sapply(seq(1,13,1), function(v) return(paste("B17026_",str_pad(v,3,pad ="0"),sep=""))))
acs_housing_costs_variables<-c(sapply(seq(1,17,1), function(v) return(paste("B25104_",str_pad(v,3,pad ="0"),sep=""))))
acs_home_values<-c('B25082_002', 'B25082_003')
all_variables<-as.data.frame(c(acs_pop,acs_race_variables,acs_rent_own,acs_income_poverty_variables,acs_language_variables,acs_home_values,acs_rent_cost_variables,acs_rent_percent_income_variables,acs_income_to_poverty_variables,acs_housing_costs_variables))%>%
dplyr::rename("name"=1)%>%
left_join(acs_variables)
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,1))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,concept),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)#%>%
# mutate(value="x")%>%
#pivot_wider(names_from = label, values_from = value)
all_variables<-as.data.frame(c(acs_pop,acs_race_variables,acs_rent_own,acs_income_poverty_variables,acs_language_variables,acs_home_values,acs_rent_cost_variables,acs_rent_percent_income_variables,acs_income_to_poverty_variables,acs_housing_costs_variables))%>%
dplyr::rename("name"=1)%>%
left_join(acs_variables)
variables_join<-all_variables%>%
mutate(label=str_remove(label,"Estimate!!"))%>%
mutate(label=str_remove(label,"Total:!!"),
word=word(concept,1,1))%>%
mutate(label=ifelse(str_detect(label,"Total:"),paste(label,concept),label))%>%
dplyr::select(1,2)%>%
dplyr::rename("variable"=1)#%>%
acs_call_table <- get_acs(geography = geoLevel,
variables = c(acs_race_variables,
acs_income_poverty_variables,
#acs_housing_costs_variables,
acs_home_values,
acs_rent_own,
acs_rent_cost_variables,
acs_rent_percent_income_variables),
year = 2020,
sumfile = sumfile,
state = state,
county=county,
geometry = FALSE) %>%
dplyr::select(-moe) %>%
left_join(variables_join,by="variable")%>%
dplyr::select(-3)%>%
pivot_wider(names_from = label,values_from = estimate)
